# 账单管理平台 - 需求文档

## 1. 项目概述

账单管理平台是一个用于个人/家庭财务管理的 Web 应用，支持通过 Excel 文件导入账单数据，并提供多维度的统计分析和可视化展示。

## 2. 技术栈

| 层级 | 技术 |
|------|------|
| 前端框架 | Next.js 15 (App Router) |
| UI 组件库 | Ant Design 5.x |
| 语言 | TypeScript |
| 数据校验 | Zod |
| ORM | Prisma |
| 数据库 | PostgreSQL |
| 图表 | ECharts |
| Excel 解析 | xlsx (SheetJS) |
| AI | OpenAI API (可配置) |

## 3. 核心数据模型

### 3.1 账单 (Bill)
- 日期、金额、优惠金额、实付金额
- 收支类型（收入/支出）
- 分类（多级树形，单选）
- 标签（多级树形，多选，一对多）
- 备注
- 数据来源（手动录入 / 一木记账 / 其他）
- 导入批次号

### 3.2 分类 (Category)
- 名称、图标、颜色、排序
- 父子层级关系（自引用）
- 支持收入/支出类型区分

### 3.3 标签 (Tag)
- 名称、颜色、排序
- 父子层级关系（自引用）

### 3.4 导入批次 (ImportBatch)
- 文件名、数据源类型、导入时间
- 导入数量、成功/失败数量

## 4. 功能模块

### 4.1 Dashboard 统计看板
- **时间维度统计**：支持按年、月、日切换
- **收支概览**：总收入、总支出、净收入、账单笔数
- **分类统计**：饼图/环形图展示各分类占比
- **趋势图**：折线图展示收支变化趋势
- **标签云图**：词云展示标签使用频率
- **大额账单**：列表展示单笔金额较大的账单 TOP N
- **筛选功能**：支持按分类、标签进行筛选统计

### 4.2 分类管理
- 树形结构展示所有分类
- 支持添加、编辑、删除分类
- 支持拖拽排序
- 支持多级分类（无限层级）
- 删除分类时检查关联账单，提示用户处理

### 4.3 标签管理
- 树形结构展示所有标签
- 支持添加、编辑、删除标签
- 支持多级标签（无限层级）
- 删除标签时检查关联账单，提示用户处理

### 4.4 账单管理
- 表格展示账单列表，支持分页
- 支持按日期范围、分类、标签筛选
- 支持按金额排序
- 支持编辑账单（修改分类、标签、备注等）
- 支持删除账单（软删除）
- 支持手动新增账单
- 按父分类/父标签查询时，自动包含所有子级关联数据

### 4.5 账单上传
- 支持 Excel 文件上传（.xlsx / .xls）
- 适配一木记账导出的 Excel 格式
- 可扩展的数据源适配器架构
- 上传前预览解析结果
- 支持字段映射确认
- 去重检测（日期+金额+备注）
- 导入批次记录，支持按批次查看/回滚
- AI 辅助：自动推荐分类和标签

### 4.6 AI 分析
- 根据账单的备注/描述，自动推荐匹配的分类
- 根据账单的备注/描述，自动推荐匹配的标签
- 批量处理导入的账单数据
- 支持用户确认或修改 AI 推荐结果

## 5. 非功能需求

- 响应式布局，支持桌面端和移动端
- 所有列表支持分页加载
- 操作反馈（加载状态、成功/失败提示）
- 数据软删除，支持恢复
- API 统一错误处理
- 数据库 Migration 管理

## 6. 页面路由规划

| 路由 | 页面 | 说明 |
|------|------|------|
| `/` | Dashboard | 统计看板 |
| `/bills` | 账单管理 | 账单列表与管理 |
| `/bills/upload` | 账单上传 | Excel 上传与导入 |
| `/categories` | 分类管理 | 分类树形管理 |
| `/tags` | 标签管理 | 标签树形管理 |
| `/settings` | 设置 | AI 配置等系统设置 |
